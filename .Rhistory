rawPathway_list = Pagwas$rawPathway_list,
snp_gene_df = Pagwas$snp_gene_df,
backingpath=backingpath,
n.cores=n.cores,
Rns=Rn[pathway],
)
pca_scCell_mat = Pagwas$pca_scCell_mat
data_mat = Pagwas$data_mat
rawPathway_list = Pagwas$rawPathway_list
snp_gene_df = Pagwas$snp_gene_df
backingpath=backingpath
backingpath
Rns=Rn[pathway]
Rns
pathway <- unique(pa_block$block_info$pathway)
x <- matrix(pca_scCell_mat[pathway, ], nrow = 1)
rownames(x) <- pathway
if (pa_block$n_snps == 0) {
pa_block$include_in_inference <- F
pa_block$x <- NULL # to make sure we totally replace previous stuffs
return(pa_block)
}
mg <- intersect(rawPathway_list[[pathway]], rownames(data_mat))
if (length(mg) == 1) {
x2 <- matrix(data_mat[mg, ], nrow = 1)
x2 <- x2 / (x2 + 0.0001)
rownames(x2) <- mg
} else {
x2 <- biganalytics::apply(data_mat[mg, ], 2, function(ge) {
if (sum(ge) == 0) {
return(rep(0, length(ge)))
} else {
return(ge / sum(ge))
}
})
rownames(x2) <- mg
}
x2 <- as(x2, "CsparseMatrix")
if (pa_block$n_snps > 1) {
x2 <- x2[pa_block$snps$label, ]
pa_block$n_snps <- nrow(pa_block$snps)
x <- x[rep(1, pa_block$n_snps), ]
rownames(x) <- pa_block$snps$rsid
#x <- x * snp_gene_df[pa_block$snps$rsid, "slope"]
x2 <- x2 * x
} else {
x2 <- matrix(x2[pa_block$snps$label, ], nrow = 1)
rownames(x2) <- pa_block$snps$label
pa_block$n_snps <- nrow(pa_block$snps)
x <- matrix(x[rep(1, pa_block$n_snps), ], nrow = 1)
rownames(x) <- pa_block$snps$rsid
#x <- matrix(as.numeric(x) * as.numeric(
#  snp_gene_df[pa_block$snps$rsid, "slope"]
#), nrow = 1)
x2 <- matrix(as.numeric(x2) * as.numeric(x), nrow = 1)
x2 <- as(x2, "CsparseMatrix")
}
pa_block$x <- as(pa_block$ld_matrix_squared %*% x2 , "CsparseMatrix")
pa_block$include_in_inference <- T
noise_per_snp <- pa_block$snps$se**2
if (pa_block$n_snps > 2) {
na_elements <- is.na(pa_block$y) | apply(pa_block$x, 1, function(x) {
any(is.na(x))
}) | is.na(noise_per_snp)
results <- scParameter_regression(
Pagwas_x = pa_block$x[!na_elements, ],
Pagwas_y = pa_block$y[!na_elements],
noise_per_snp = noise_per_snp[!na_elements],
Rns=Rns,
backingpath=backingpath,
n.cores=n.cores
)
}}}}
na_elements <- is.na(pa_block$y) | apply(pa_block$x, 1, function(x) {
any(is.na(x))
}) | is.na(noise_per_snp)
results <- scParameter_regression(
Pagwas_x = pa_block$x[!na_elements, ],
Pagwas_y = pa_block$y[!na_elements],
noise_per_snp = noise_per_snp[!na_elements],
Rns=Rns,
backingpath=backingpath,
n.cores=n.cores
)
results
results[is.na(results)] <- 0
names(results) <- colnames(data_mat)
get_Pathway_sclm(
pa_block = pa_block,
pca_scCell_mat = Pagwas$pca_scCell_mat,
data_mat = Pagwas$data_mat,
rawPathway_list = Pagwas$rawPathway_list,
snp_gene_df = Pagwas$snp_gene_df,
backingpath=backingpath,
n.cores=n.cores,
Rns=Rn[pathway],
)
Pathway_sclm_results[[pathway]] <- get_Pathway_sclm(
pa_block = pa_block,
pca_scCell_mat = Pagwas$pca_scCell_mat,
data_mat = Pagwas$data_mat,
rawPathway_list = Pagwas$rawPathway_list,
snp_gene_df = Pagwas$snp_gene_df,
backingpath=backingpath,
n.cores=n.cores,
Rns=Rn[pathway]
)
if (file.exists(paste0("./", output.dirs, "/temp"))) {
unlink(paste0("./", output.dirs, "/temp"),recursive = TRUE)
cat("bk files has been deleted")
}
if (file.exists(paste0("./", output.dirs, "/temp"))) {
unlink(paste0("./", output.dirs, "/temp"),recursive = TRUE)
cat("bk files has been deleted")
}
devtools::load_all(".")
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Sat Nov 19 10:26:21 2022 ------##
##------ Sat Nov 19 10:26:25 2022 ------##
##------ Sat Nov 19 10:26:35 2022 ------##
##------ Sat Nov 19 10:26:35 2022 ------##
##------ Sat Nov 19 10:26:36 2022 ------##
##------ Sat Nov 19 10:26:37 2022 ------##
##------ Sat Nov 19 10:28:48 2022 ------##
##------ Sat Nov 19 10:28:49 2022 ------##
##------ Sat Nov 19 10:28:54 2022 ------##
renv::snapshot()
devtools::document()
devtools::document()
devtools::load_all(".")
devtools::load_all(".")
devtools::document()
devtools::document()
library(scPagwas)
Pagwas_celltypes<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=F,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
##------ Sat Nov 19 11:00:35 2022 ------##
##------ Sat Nov 19 11:00:40 2022 ------##
devtools::document()
devtools::load_all(".")
Pagwas_celltypes<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=F,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
##------ Sat Nov 19 11:24:54 2022 ------##
##------ Sat Nov 19 11:24:57 2022 ------##
##------ Sat Nov 19 11:25:15 2022 ------##
##------ Sat Nov 19 11:25:15 2022 ------##
##------ Sat Nov 19 11:25:15 2022 ------##
##------ Sat Nov 19 11:25:17 2022 ------##
##------ Sat Nov 19 11:25:58 2022 ------##
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Sat Nov 19 11:29:18 2022 ------##
##------ Sat Nov 19 11:29:22 2022 ------##
##------ Sat Nov 19 11:29:38 2022 ------##
##------ Sat Nov 19 11:29:38 2022 ------##
##------ Sat Nov 19 11:29:38 2022 ------##
##------ Sat Nov 19 11:29:39 2022 ------##
##------ Sat Nov 19 11:31:44 2022 ------##
##------ Sat Nov 19 11:31:45 2022 ------##
##------ Sat Nov 19 11:31:50 2022 ------##
devtools::load_all(".")
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Sat Nov 19 11:38:06 2022 ------##
##------ Sat Nov 19 11:38:09 2022 ------##
##------ Sat Nov 19 11:38:20 2022 ------##
##------ Sat Nov 19 11:38:20 2022 ------##
##------ Sat Nov 19 11:38:21 2022 ------##
##------ Sat Nov 19 11:38:22 2022 ------##
##------ Sat Nov 19 11:40:27 2022 ------##
##------ Sat Nov 19 11:40:28 2022 ------##
##------ Sat Nov 19 11:40:33 2022 ------##
devtools::document()
library(scPagwas)
Pagwas_celltypes<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=F,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
##------ Sat Nov 19 11:48:11 2022 ------##
##------ Sat Nov 19 11:48:16 2022 ------##
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Sat Nov 19 11:50:01 2022 ------##
##------ Sat Nov 19 11:50:05 2022 ------##
devtools::load_all(".")
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Sat Nov 19 11:54:58 2022 ------##
##------ Sat Nov 19 11:55:02 2022 ------##
##------ Sat Nov 19 11:55:17 2022 ------##
##------ Sat Nov 19 11:55:17 2022 ------##
##------ Sat Nov 19 11:55:18 2022 ------##
##------ Sat Nov 19 11:55:19 2022 ------##
##------ Sat Nov 19 11:57:56 2022 ------##
##------ Sat Nov 19 11:57:58 2022 ------##
##------ Sat Nov 19 11:58:03 2022 ------##
library(scPagwas)
Pagwas_celltypes<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=F,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
##------ Sat Nov 19 12:01:52 2022 ------##
##------ Sat Nov 19 12:01:56 2022 ------##
##------ Sat Nov 19 12:02:13 2022 ------##
##------ Sat Nov 19 12:02:13 2022 ------##
##------ Sat Nov 19 12:02:13 2022 ------##
##------ Sat Nov 19 12:02:14 2022 ------##
##------ Sat Nov 19 12:02:57 2022 ------##
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Sat Nov 19 12:04:00 2022 ------##
##------ Sat Nov 19 12:04:04 2022 ------##
##------ Sat Nov 19 12:04:16 2022 ------##
##------ Sat Nov 19 12:04:16 2022 ------##
##------ Sat Nov 19 12:04:16 2022 ------##
##------ Sat Nov 19 12:04:18 2022 ------##
##------ Sat Nov 19 12:06:23 2022 ------##
##------ Sat Nov 19 12:06:25 2022 ------##
##------ Sat Nov 19 12:06:29 2022 ------##
usethis::use_version()
devtools::document()
renv::snapshot()
library(scPagwas)
renv::snapshot()
devtools::document()
devtools::document()
renv::snapshot()
devtools::document()
library(scPagwas)
devtools::load_all(".")
devtools::load_all(".")
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Wed Nov 23 16:31:05 2022 ------##
##------ Wed Nov 23 16:31:09 2022 ------##
devtools::load_all(".")
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Wed Nov 23 16:41:15 2022 ------##
##------ Wed Nov 23 16:41:20 2022 ------##
devtools::load_all(".")
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Wed Nov 23 16:47:53 2022 ------##
##------ Wed Nov 23 16:47:57 2022 ------##
devtools::load_all(".")
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Wed Nov 23 16:51:54 2022 ------##
##------ Wed Nov 23 16:51:58 2022 ------##
##------ Wed Nov 23 16:52:13 2022 ------##
##------ Wed Nov 23 16:52:13 2022 ------##
##------ Wed Nov 23 16:52:13 2022 ------##
##------ Wed Nov 23 16:52:15 2022 ------##
##------ Wed Nov 23 16:54:26 2022 ------##
##------ Wed Nov 23 16:54:27 2022 ------##
##------ Wed Nov 23 16:54:33 2022 ------##
devtools::document()
renv::snapshot()
library(scPagwas)
single_data<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
single_data
Single_data<-GetAssayData(Single_data, slot = "data", assay = assay)
library(scPagwas)
library(scPagwas)
Pagwas <- list()
Single_data <- readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
Pagwas <- Single_data_input(
Pagwas = Pagwas,
assay = "RNA",
Single_data = Single_data,
Pathway_list = Genes_by_pathway_kegg
)
names(Pagwas)
Pagwas$data_mat[1:10,1:10]
Pagwas$data_mat[,1:10]
dim(Pagwas$data_mat)
df<- data.frame(Pagwas$data_mat[,1:10])
gg_scgene<-as.data.frame(Pagwas$data_mat[,1:10])
gg_scgene$gene<-rownames(gg_scgene)
#library(reshape2)
gg_scgene<-reshape2::melt(gg_scgene,id.vars="gene")
ggplot(gg_scgene, aes(x=value,color=variable))+
geom_density()+
scale_color_brewer()+
theme_classic()+
labs(title="gene")+
theme(legend.position="none")
library(ggplot2)
ggplot(gg_scgene, aes(x=value,color=variable))+
geom_density()+
scale_color_brewer()+
theme_classic()+
labs(title="gene")+
theme(legend.position="none")
a<-log2(a)
a<-Pagwas$data_mat[,1:10]
a<-log2(a)
gg_scgene<-as.data.frame(a)
a<-Pagwas$data_mat[,1:10]
a<-log2(a+1)
gg_scgene<-as.data.frame(a)
gg_scgene$gene<-rownames(gg_scgene)
#library(reshape2)
gg_scgene<-reshape2::melt(gg_scgene,id.vars="gene")
ggplot(gg_scgene, aes(x=value,color=variable))+
geom_density()+
scale_color_brewer()+
theme_classic()+
labs(title="gene")+
theme(legend.position="none")
a<-log2(a+1)
gg_scgene<-as.data.frame(a)
gg_scgene$gene<-rownames(gg_scgene)
#library(reshape2)
gg_scgene<-reshape2::melt(gg_scgene,id.vars="gene")
ggplot(gg_scgene, aes(x=value,color=variable))+
geom_density()+
scale_color_brewer()+
theme_classic()+
labs(title="gene")+
theme(legend.position="none")
a<-log2(a+1)
gg_scgene<-as.data.frame(a)
gg_scgene$gene<-rownames(gg_scgene)
#library(reshape2)
gg_scgene<-reshape2::melt(gg_scgene,id.vars="gene")
#library(ggplot2)
#pdf("E:/OneDrive/GWAS_Multiomics/Distribution_test/singlegene_distribution.pdf",width = 4,height = 6)
ggplot(gg_scgene, aes(x=value,color=variable))+
geom_density()+
scale_color_brewer()+
theme_classic()+
labs(title="gene")+
theme(legend.position="none")
library(scPagwas)
system.time(
Pagwas_singlecell<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
)
##------ Sun Nov 27 10:30:27 2022 ------##
##------ Sun Nov 27 10:30:32 2022 ------##
##------ Sun Nov 27 10:30:47 2022 ------##
##------ Sun Nov 27 10:30:47 2022 ------##
##------ Sun Nov 27 10:30:47 2022 ------##
##------ Sun Nov 27 10:30:48 2022 ------##
##------ Sun Nov 27 10:33:04 2022 ------##
##------ Sun Nov 27 10:33:06 2022 ------##
##------ Sun Nov 27 10:33:10 2022 ------##
renv::snapshot()
devtools::document()
library(scPagwas)
sample(1:1000,1)
pathway="abd"
paste0(pathway,sample(1:1000,1))
renv::snapshot()
devtools::document()
library(scPagwas)
library(tidyverse)
?write_tsv
