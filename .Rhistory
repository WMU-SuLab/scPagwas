celltype=T,
ncores = 2,
split_n=1)
##------ Thu Jun 09 10:43:33 2022 ------##
##------ Thu Jun 09 10:43:37 2022 ------##
##------ Thu Jun 09 10:43:38 2022 ------##
##------ Thu Jun 09 10:43:38 2022 ------##
##------ Thu Jun 09 10:43:39 2022 ------##
##------ Thu Jun 09 10:43:56 2022 ------##
##------ Thu Jun 09 10:43:57 2022 ------##
##------ Thu Jun 09 10:44:03 2022 ------##
Pagwas_data
head(Pagwas_data@meta.data)
names(Pagwas_data@misc)
Pagwas_data<-scPagwas_main(Pagwas = Pagwas_data,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
#Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Thu Jun 09 10:47:54 2022 ------##
##------ Thu Jun 09 10:47:58 2022 ------##
##------ Thu Jun 09 10:47:59 2022 ------##
##------ Thu Jun 09 10:47:59 2022 ------##
##------ Thu Jun 09 10:48:01 2022 ------##
##------ Thu Jun 09 10:48:17 2022 ------##
##------ Thu Jun 09 10:48:18 2022 ------##
##------ Thu Jun 09 10:48:25 2022 ------##
Pagwas_data
gc()
renv::snapshot()
devtools::load_all(".")
library(ggplot2)
suppressMessages(library(Seurat))
suppressMessages(library("dplyr"))
#Input pathway gene list, you can construct with youself.
data(Genes_by_pathway_kegg)
#gene annotation files.
data(block_annotation)
#LD data
data(chrom_ld)
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=F,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Thu Jun 09 16:15:02 2022 ------##
##------ Thu Jun 09 16:15:09 2022 ------##
##------ Thu Jun 09 16:15:22 2022 ------##
##------ Thu Jun 09 16:15:22 2022 ------##
##------ Thu Jun 09 16:15:23 2022 ------##
##------ Thu Jun 09 16:15:25 2022 ------##
##------ Thu Jun 09 16:15:34 2022 ------##
Pagwas_data<-scPagwas_main(Pagwas = Pagwas_data,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
#Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=F,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Thu Jun 09 16:15:54 2022 ------##
##------ Thu Jun 09 16:15:54 2022 ------##
##------ Thu Jun 09 16:15:55 2022 ------##
##------ Thu Jun 09 16:15:57 2022 ------##
names(Pagwas_data)
devtools::load_all(".")
devtools::load_all(".")
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=F,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Thu Jun 09 16:19:40 2022 ------##
##------ Thu Jun 09 16:19:45 2022 ------##
##------ Thu Jun 09 16:19:59 2022 ------##
##------ Thu Jun 09 16:19:59 2022 ------##
##------ Thu Jun 09 16:19:59 2022 ------##
##------ Thu Jun 09 16:20:01 2022 ------##
##------ Thu Jun 09 16:20:07 2022 ------##
names(Pagwas_data)
Pagwas_data<-scPagwas_main(Pagwas = Pagwas_data,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
#Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=F,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Thu Jun 09 16:21:27 2022 ------##
##------ Thu Jun 09 16:21:27 2022 ------##
##------ Thu Jun 09 16:21:27 2022 ------##
##------ Thu Jun 09 16:21:29 2022 ------##
##------ Thu Jun 09 16:21:35 2022 ------##
names(Pagwas_data)
Pagwas_data<-scPagwas_main(Pagwas = Pagwas_data,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Thu Jun 09 16:22:11 2022 ------##
##------ Thu Jun 09 16:22:16 2022 ------##
##------ Thu Jun 09 16:22:16 2022 ------##
##------ Thu Jun 09 16:22:17 2022 ------##
##------ Thu Jun 09 16:22:18 2022 ------##
##------ Thu Jun 09 16:22:33 2022 ------##
##------ Thu Jun 09 16:22:34 2022 ------##
##------ Thu Jun 09 16:22:39 2022 ------##
Pagwas_data
devtools::load_all(".")
#1.start to run the wrapper functions for preprogress.
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=3)
##------ Fri Jun 10 09:24:27 2022 ------##
##------ Fri Jun 10 09:24:35 2022 ------##
##------ Fri Jun 10 09:24:51 2022 ------##
##------ Fri Jun 10 09:24:51 2022 ------##
##------ Fri Jun 10 09:24:52 2022 ------##
##------ Fri Jun 10 09:24:53 2022 ------##
##------ Fri Jun 10 09:25:17 2022 ------##
##------ Fri Jun 10 09:25:18 2022 ------##
##------ Fri Jun 10 09:25:22 2022 ------##
scPagwas_Visualization(Single_data=Pagwas_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "red",
output.dirs="scPagwastest_output",
size = 0.5,
do_plot = T)
?gather
??gather
??read_tsv
??v
??ggdonutchart
??element_markdown
?merge
?merge
quantile()
quantile(1:100)
library(scPagwas)
library(Seurat)
library(parallel)
load("E:/RPakage/scPagwas/data/Pagwas_AD_prune.RData")
Pagwas
length(Pagwas@misc)
unique(Pagwas@meta.data$annotation)[1:5]
head(Pagwas@meta.data)
plot_scpathway_dot(Pagwas=Pagwas,
celltypes=unique(Pagwas@oupSample.cellType$annotation)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
source("E:/RPakage/visulizeplotR/plot_scpathway_contri_dot.R")
plot_scpathway_dot(Pagwas=Pagwas,
celltypes=unique(Pagwas@oupSample.cellType$annotation)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
Idents(Pagwas)
unique(Idents(Pagwas))[1:5]
source("E:/RPakage/visulizeplotR/plot_scpathway_contri_dot.R")
plot_scpathway_dot(Pagwas=Pagwas,
celltypes=unique(Pagwas@oupSample.cellType$annotation)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
Pagwas
data(Genes_by_pathway_kegg)
data(block_annotation)
data(chrom_ld)
Pagwas_seu<-scPagwas_main(Pagwas = NULL,
gwas_data ="E:/RPakage/scPagwas/inst/extdata/AD_prune_gwas_data.txt",
output.prefix="adPrunetest",
output.dirs="adPrunetest",
block_annotation = block_annotation,
assay="RNA",
Single_data ="E:/RPakage/scPagwas/inst/extdata/GSE138852_ad.rds",
ncores=7,
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
celltype=T)
##------ Fri Jun 24 11:46:59 2022 ------##
##------ Fri Jun 24 11:47:07 2022 ------##
##------ Fri Jun 24 11:47:17 2022 ------##
##------ Fri Jun 24 11:48:02 2022 ------##
##------ Fri Jun 24 11:48:23 2022 ------##
##------ Fri Jun 24 11:48:24 2022 ------##
Pagwas_seu<-scPagwas_main(Pagwas = NULL,
gwas_data ="E:/RPakage/scPagwas/inst/extdata/AD_prune_gwas_data.txt",
output.prefix="adPrunetest",
output.dirs="adPrunetest",
block_annotation = block_annotation,
assay="RNA",
Single_data ="E:/RPakage/scPagwas/inst/extdata/GSE138852_ad.rds",
ncores=5,
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
celltype=T)
##------ Fri Jun 24 11:51:50 2022 ------##
##------ Fri Jun 24 11:51:57 2022 ------##
##------ Fri Jun 24 11:52:15 2022 ------##
##------ Fri Jun 24 11:53:04 2022 ------##
##------ Fri Jun 24 11:53:28 2022 ------##
##------ Fri Jun 24 11:53:31 2022 ------##
##------ Fri Jun 24 12:06:57 2022 ------##
##------ Fri Jun 24 12:09:20 2022 ------##
##------ Fri Jun 24 12:09:43 2022 ------##
save(Pagwas_seu,file="E:/RPakage/scPagwas/data/Pagwas_AD_prune.RData")
library(tidyverse)
library("rhdf5")
library(ggplot2)
library(grDevices)
library(stats)
library(FactoMineR)
library(scales)
library(reshape2)
library(ggdendro)
library(grImport2)
library(gridExtra)
library(grid)
library(sisal)
source("E:/RPakage/visulizeplotR/plot_scpathway_contri_dot.R")
plot_scpathway_dot(Pagwas=Pagwas,
celltypes=unique(Pagwas@oupSample.cellType$annotation)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
Pagwas
?GetAssayData()
GetAssayData(Pagwas,assay ="scPagwasPaHeritability")
source("E:/RPakage/visulizeplotR/plot_scpathway_contri_dot.R")
plot_scpathway_dot(Pagwas=Pagwas,
celltypes=unique(Pagwas@oupSample.cellType$annotation)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
names(Pagwas@misc)
Pagwas@misc
Pagwas_seu
names(Pagwas_seu@misc)
source("E:/RPakage/visulizeplotR/plot_scpathway_contri_dot.R")
plot_scpathway_dot(Pagwas=Pagwas_seu,
celltypes=unique(Pagwas@oupSample.cellType$annotation)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
plot_scpathway_dot(Pagwas=Pagwas_seu,
celltypes=unique(Pagwas$oupSample.cellType)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
Pagwas=Pagwas_seu
celltypes=unique(Pagwas$oupSample.cellType)[1:5]
topn_path_celltype=5
filter_p=0.05
max_logp=15
display_max_sizes=F
size_var ="logrankPvalue"
col_var="proportion"
shape.scale = 8
cols.use=c("lightgrey", "#E45826")
dend_x_var = "logrankPvalue"
dist_method="euclidean"
hclust_method="ward.D"
do_plot = T
proportion_list <- tapply(
as.vector(Idents(Pagwas)),
Idents(Pagwas), function(x) {
a <- apply(GetAssayData(Pagwas,assay ="scPagwasPaHeritability"), 2, function(y) sum(y > 0) / length(y))
return(unlist(a))
}
)
proportion_list
proportion_df <- Reduce(function(dtf1, dtf2) cbind(dtf1, dtf2), proportion_list)
colnames(proportion_df) <- names(proportion_list)
head(proportion_df)
scPathrankP <- -log10(Pagwas@misc$scPathways_rankPvalue + 1e-20)
scPathrankP
top_function <- function(para_mat, n_path_to_keep = 5) {
para_mat$path <- rownames(para_mat)
# Only keep genes with a unique name and tidy data.
para_mat <- para_mat %>%
add_count(path) %>%
filter(n == 1) %>%
select(-n) %>%
gather(key = celltypes, value = paras, -path) %>%
as_tibble()
para_mat <- para_mat %>%
group_by(celltypes) %>%
mutate(paras_sum_mean = (paras * nrow(scPathrankP)) / sum(paras))
para_mat <- para_mat %>%
group_by(path) %>%
mutate(specificity = (paras_sum_mean * nrow(scPathrankP)) / sum(paras_sum_mean)) %>%
ungroup()
d_spe <- para_mat %>% filter(paras_sum_mean > 1)
d_spe <- d_spe %>%
group_by(celltypes) %>%
top_n(., n_path_to_keep, specificity)
return(d_spe)
}
spe2 <- top_function(para_mat = scPathrankP, n_path_to_keep = topn_path_celltype)
head(spe2)
spe2$celltypes
celltypes
spe2 <- spe2[spe2$celltypes %in% celltypes, ]
spe <- unique(spe2$path)
head(spe)
spe2
scPathrankP <- scPathrankP[spe, celltypes]
proportion_df <- proportion_df[spe, celltypes]
proportion_df <- as.data.frame(proportion_df)
spe
celltypes
head(proportion_df)
spe
scPagwasPaHeritability<-t(GetAssayData(Pagwas,assay ="scPagwasPaHeritability"))
scPagwasPaHeritability
proportion_list <- tapply(
as.vector(Idents(Pagwas)),
Idents(Pagwas), function(x) {
scPagwasPaHeritability<-t(GetAssayData(Pagwas,assay ="scPagwasPaHeritability"))
a <- apply(scPagwasPaHeritability, 2, function(y) sum(y > 0) / length(y))
return(unlist(a))
}
)
proportion_df <- Reduce(function(dtf1, dtf2) cbind(dtf1, dtf2), proportion_list)
colnames(proportion_df) <- names(proportion_list)
head(proportion_df)
source("E:/RPakage/visulizeplotR/plot_scpathway_contri_dot.R")
plot_scpathway_dot(Pagwas=Pagwas_seu,
celltypes=unique(Pagwas$oupSample.cellType)[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
unique(Idents(Pagwas))[1:5]
plot_scpathway_dot(Pagwas=Pagwas_seu,
celltypes=unique(Idents(Pagwas))[1:5],
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
figurenames = NULL,
width = 7,
height = 7)
