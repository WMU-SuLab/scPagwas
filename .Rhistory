do_plot = T)
#dev.off()
fortify.Seurat <- function(x){
xy <- as.data.frame(Embeddings(x, reduction = "umap"))
colnames(xy) <- c("UMAP_1", "UMAP_2")
xy$UMAP_1 <- as.numeric(xy$UMAP_1)
xy$UMAP_2 <- as.numeric(xy$UMAP_2)
xy2 <- as.data.frame(Embeddings(x, reduction = "tsne"))
colnames(xy2) <- c("TSNE_1", "TSNE_2")
xy2$TSNE_1 <- as.numeric(xy2$TSNE_1)
xy2$TSNE_2 <- as.numeric(xy2$TSNE_2)
xy<-cbind(xy,xy2)
return(cbind(xy, as.data.frame(x@meta.data)))
}
all_fortify_can <- fortify.Seurat(Single_data)
#Pagwas$Pathway_single_results
Pagwas$Celltype_anno$scPagwas_score<-Pagwas$scPagwas_score
Pagwas$Celltype_anno$pValueHigh <-Pagwas$CellsrankPvalue$pValueHigh
#Pagwas$Celltype_anno$slingPseudotime<- slingPseudotime[rownames(Pagwas$Celltype_anno)]
Pagwas_pca<-as.data.frame(t(data.matrix(Pagwas$Pathway_single_results)))
Pagwas_pca <- do.call(data.frame,                      # Replace Inf in data by NA
lapply(Pagwas_pca,
function(x) replace(x, is.infinite(x), NA)))
Pagwas_pca<- t(na.omit(t(Pagwas_pca)))
rownames(Pagwas_pca)<-colnames(Pagwas$Pathway_single_results)
Pagwas_seu<-CreateSeuratObject(
Pagwas_pca,
project = "CreateSeuratObject",
assay = "RNA",
names.field = 1,
names.delim = "_",
meta.data = Pagwas$Celltype_anno[colnames(Pagwas_pca),]
)
Idents(Pagwas_seu)<-Pagwas_seu$annotation
#ls_scCell_markerpa <- FindAllMarkers(object = ls_scCell)
#Pagwas_seu$slingPseudotime<-slingPseudotime[colnames(Pagwas_seu)]
Pagwas_seu<-ScaleData(Pagwas_seu)
Pagwas_seu <- FindVariableFeatures(object = Pagwas_seu,nfeatures = round(dim(Pagwas_seu)[1]*0.2))
Pagwas_seu <- RunPCA(object = Pagwas_seu, assay = "RNA", features = VariableFeatures(Pagwas_seu), npcs = 30)
Pagwas_seu <- RunTSNE(object = Pagwas_seu,assay = "RNA", reduction = "pca", dims = 1:30)
Pagwas_seu <- RunUMAP(object = Pagwas_seu, assay ="RNA", reduction = "pca", dims = 1:30)
Pagwas_fortify <- fortify.Seurat(Pagwas_seu)
#  pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/Slingshot.plot.pdf")
DimPlot(Pagwas_seu,group.by = "annotation",label = F)+ #umap_theme()+ ggtitle("annotation")+
theme(aspect.ratio=1)
#  dev.off()
umap_theme <- function(){
theme_grey() %+replace%
theme(panel.background = element_rect(fill = "white", colour = "white", size = 0.1),
axis.text.x  = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y  = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.key=element_blank())
}
plot1 <- ggplot() +
geom_point(data = Pagwas_fortify,
aes(x = UMAP_1, y = UMAP_2,color =scPagwas_score), size = 0.6, alpha = 1) +
umap_theme() +
scale_colour_gradient2(low="#8479E1",mid="#F7F5F2",high="#FD5D5D")+
theme(aspect.ratio=1) +
guides(colour = guide_legend(override.aes = list(size=3)))
pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/umap_opc_scPagwas_score.pdf")
print(plot1)
dev.off()
umap_theme <- function(){
theme_grey() %+replace%
theme(panel.background = element_rect(fill = "white", colour = "white", size = 0.1),
axis.text.x  = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y  = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.key=element_blank())
}
plot1 <- ggplot() +
geom_point(data = Pagwas_fortify,
aes(x = UMAP_1, y = UMAP_2,color =scPagwas_score), size = 0.6, alpha = 1) +
umap_theme() +
scale_colour_gradient2(low="#8479E1",mid="#F7F5F2",high="#FD5D5D")+
theme(aspect.ratio=1) +
guides(colour = guide_legend(override.aes = list(size=3)))
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/umap_opc_scPagwas_score.pdf")
print(plot1)
#dev.off()
Pagwas_fortify$p_thre<-rep("non",nrow(Pagwas_fortify))
Pagwas_fortify$p_thre[which(Pagwas_fortify$pValueHigh<0.05)]<-"<0.05"
plot2 <-  ggplot() +
geom_point(data = Pagwas_fortify,
aes(x = UMAP_1, y = UMAP_2,color =p_thre), size =0.6, alpha = 1) +
umap_theme() +
scale_color_manual(values = c("non" = "#05595B", "<0.05" = "#E45826"))+
theme(aspect.ratio=1) +
guides(colour = guide_legend(override.aes = list(size=3)))
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/umap_opc_scPagwas_p.pdf")
print(plot2)
#  dev.off()
suppressMessages(require("WGCNA"))
suppressMessages(require("patchwork"))
suppressMessages(require("tidygraph"))
suppressMessages(require("ggraph"))
suppressMessages(require("igraph"))
source("E:/RPakage/visulizeplotR/plot_pathway_contribution_network.R")
require("ggsci")
require("graphlayouts")
#check the objects
rownames(Pagwas$scPathways_rankPvalue)<-colnames(Pagwas$Pathway_sclm_results)
celltypes="OPC"
pathways<-rownames(Pagwas$scPathways_rankPvalue)[order(Pagwas$scPathways_rankPvalue[,"OPC"],decreasing = F)[1:5]]
pathways<-c("hsa00250","hsa04630","hsa04666","hsa00100","hsa00020")
#hsa00250 Pathway : Name: Alanine, aspartate and glutamate metabolism; Metabolism; Amino acid metabolism BRITE hierarchy.
#hsa04630:Name: JAK-STAT signaling pathway - Homo sapiens (human) Description: The Janus kinase/signal transducers and activators of transcription (JAK/STAT) pathway is one of a handful of pleiotropic cascades used to transduce a multitude of signals for development
#hsa04666: hsa04666 Pathway : Name: Fc gamma R-mediated phagocytosis - Homo sapiens (human) Description: Phagocytosis plays an essential role in host-defense mechanisms through the uptake and destruction of infectious pathogens. Specialized cell types including macrophages, neutrophils, and monocytes take part in this process in higher organisms.
#hsa00100: Glycolysis, core module involving three-carbon compounds
#hsa00020 Pathway : Name: Citrate cycle (TCA cycle) - Homo sapiens (human) Description: The citrate cycle (TCA cycle, Krebs cycle) is an important aerobic pathway for the final steps of the oxidation of carbohydrates and fatty acids.
extrafont::font_import()
library(extrafont)
loadfonts()
library(scPagwas)
library(Seurat)
Single_data =readRDS("E:/RPakage/scPagwas/inst/extdata/GSE138852_ad.rds")
load("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/Pagwas_GSE138852_Prune_adsubset_kegg.RData")
Pagwas[c("Pathway_ld_gwas_data","VariableFeatures","merge_scexpr",
"rawPathway_list",
"snp_gene_df")]<-NULL
names(Pagwas)
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
library("RColorBrewer")
library("ggplot2")
#check the objects
#Single_data<-FindVariableFeatures(Single_data)
#setwd("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test")
scPagwas_p<-Pagwas$CellsrankPvalue$pValueHigh
names(scPagwas_p)<-rownames(Pagwas$CellsrankPvalue)
sum(scPagwas_p<0.05)
pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/tsne_test_ad.pdf")
DimPlot(Single_data,reduction="tsne",group.by = "oupSample.cellType",pt.size=0.8,
label = TRUE, repel=TRUE)+ labs(x="TSNE",y="")+
scale_color_d3() +
theme(aspect.ratio=1)
dev.off()
setwd("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test")
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
scPagwas_p=scPagwas_p,
Single_data=Single_data,
p_thre = 0.05,
filename = "ad_pruneGSE138852",
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#000957", highColor = "#EBE645",
size = 0.5,
title = "scPagwas_score",
do_plot = T)
#setwd("")
Single_data$scPagwas_p <- scPagwas_p[intersect(colnames(Single_data),names(scPagwas_p))]
#thre <- sort(Single_data$scPagwas_score, decreasing = T)[ncol(Single_data) * 0.1]
Single_data$positiveCells<-rep(0,ncol(Single_data))
Single_data$positiveCells[Single_data$scPagwas_p<0.05]<-1
table(Single_data$positiveCells)
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/bar_positiveCells.pdf")
plot_bar_positie_nagtive(seurat_obj=Single_data,
var_ident="positiveCells",
var_group="oupSample.cellType",
vec_group_colors=NULL,
f_color=colorRampPalette(brewer.pal(n=10, name="RdYlBu")),
do_plot = T)
#dev.off()
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/bar_positiveCells_celltypes.pdf")
plot_bar_positie_nagtive(seurat_obj=Single_data,
var_ident="oupSample.cellType",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
#dev.off()
fortify.Seurat <- function(x){
xy <- as.data.frame(Embeddings(x, reduction = "umap"))
colnames(xy) <- c("UMAP_1", "UMAP_2")
xy$UMAP_1 <- as.numeric(xy$UMAP_1)
xy$UMAP_2 <- as.numeric(xy$UMAP_2)
xy2 <- as.data.frame(Embeddings(x, reduction = "tsne"))
colnames(xy2) <- c("TSNE_1", "TSNE_2")
xy2$TSNE_1 <- as.numeric(xy2$TSNE_1)
xy2$TSNE_2 <- as.numeric(xy2$TSNE_2)
xy<-cbind(xy,xy2)
return(cbind(xy, as.data.frame(x@meta.data)))
}
all_fortify_can <- fortify.Seurat(Single_data)
#Pagwas$Pathway_single_results
Pagwas$Celltype_anno$scPagwas_score<-Pagwas$scPagwas_score
Pagwas$Celltype_anno$pValueHigh <-Pagwas$CellsrankPvalue$pValueHigh
#Pagwas$Celltype_anno$slingPseudotime<- slingPseudotime[rownames(Pagwas$Celltype_anno)]
Pagwas_pca<-as.data.frame(t(data.matrix(Pagwas$Pathway_single_results)))
Pagwas_pca <- do.call(data.frame,                      # Replace Inf in data by NA
lapply(Pagwas_pca,
function(x) replace(x, is.infinite(x), NA)))
Pagwas_pca<- t(na.omit(t(Pagwas_pca)))
rownames(Pagwas_pca)<-colnames(Pagwas$Pathway_single_results)
Pagwas_seu<-CreateSeuratObject(
Pagwas_pca,
project = "CreateSeuratObject",
assay = "RNA",
names.field = 1,
names.delim = "_",
meta.data = Pagwas$Celltype_anno[colnames(Pagwas_pca),]
)
Idents(Pagwas_seu)<-Pagwas_seu$annotation
#ls_scCell_markerpa <- FindAllMarkers(object = ls_scCell)
#Pagwas_seu$slingPseudotime<-slingPseudotime[colnames(Pagwas_seu)]
Pagwas_seu<-ScaleData(Pagwas_seu)
Pagwas_seu <- FindVariableFeatures(object = Pagwas_seu,nfeatures = round(dim(Pagwas_seu)[1]*0.2))
Pagwas_seu <- RunPCA(object = Pagwas_seu, assay = "RNA", features = VariableFeatures(Pagwas_seu), npcs = 30)
Pagwas_seu <- RunTSNE(object = Pagwas_seu,assay = "RNA", reduction = "pca", dims = 1:30)
Pagwas_seu <- RunUMAP(object = Pagwas_seu, assay ="RNA", reduction = "pca", dims = 1:30)
Pagwas_fortify <- fortify.Seurat(Pagwas_seu)
#  pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/Slingshot.plot.pdf")
DimPlot(Pagwas_seu,group.by = "annotation",label = F)+ #umap_theme()+ ggtitle("annotation")+
theme(aspect.ratio=1)
#  dev.off()
suppressMessages(require("WGCNA"))
suppressMessages(require("patchwork"))
suppressMessages(require("tidygraph"))
suppressMessages(require("ggraph"))
suppressMessages(require("igraph"))
source("E:/RPakage/visulizeplotR/plot_pathway_contribution_network.R")
require("ggsci")
require("graphlayouts")
#check the objects
rownames(Pagwas$scPathways_rankPvalue)<-colnames(Pagwas$Pathway_sclm_results)
celltypes="OPC"
pathways<-rownames(Pagwas$scPathways_rankPvalue)[order(Pagwas$scPathways_rankPvalue[,"OPC"],decreasing = F)[1:5]]
pathways<-c("hsa00250","hsa04630","hsa04666","hsa00100","hsa00020")
#hsa00250 Pathway : Name: Alanine, aspartate and glutamate metabolism; Metabolism; Amino
library(extrafont)
loadfonts()
lapply(1:length(pathways),function(ss){
pathway<-pathways[ss]
# library(showtext)
#fond_add('Arial Narrow','/Library/Fonts/ArialNarrow.tiff')
# pdf(paste0("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/",pathway,"_pthway_network.pdf"))
plot_pathway_contribution_network(mat_datExpr=Single_data@assays$RNA@data, gene_contribution=Pagwas$gene_heritability_correlation,
Celltype_anno=Pagwas$Celltype_anno,
Pathway_list=Pagwas$Pathway_list,
celltypes="OPC",
pathwat_select=pathway,
pathways_thre=0.05,
adjacency.power=4,
n_max_genes=100,
#edge_filter=0.00015,
text_topn=10,
igraph_algorithm = "drl",
h_method = "complete",
fontface_labels="bold.italic",
color_edge = "#9D9D9D",
color_group=pal_d3(alpha =0.5)(5)[ss],
node_alpha=0.8,
fontSize_label_lg=2,
fontSize_legend_lg=3,
fontSize_legend_xlg=3,
limits=c(-0.1,0.1),
range=c(1,7),
edge_thickness = 2,
do_plot=T , #figurenames=paste0("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/",pathway,"_pthway_network.pdf"),
width=10,
height=10
)
#dev.off()
})
library(tidyverse)
library("rhdf5")
library(ggplot2)
library(grDevices)
library(stats)
library(FactoMineR)
library(scales)
library(reshape2)
library(ggdendro)
library(grImport2)
library(gridExtra)
library(grid)
library(sisal)
source("E:/RPakage/visulizeplotR/plot_scpathway_contri_dot.R")
plot_scpathway_dot(Pagwas=Pagwas,
topn_path_celltype=5,
filter_p=0.05,
max_logp=8,
display_max_sizes=F,
size_var = "lm_beta",
col_var="logrankPvalue",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "lm_beta",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
#figurenames = "E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/pathway_test_dotplot.pdf",
width = 12,
height = 7)
source("E:/RPakage/visulizeplotR/heritability_cor_scatterplot.R")
heritability_cor_scatterplot(gene_heri_cor=Pagwas$gene_heritability_correlation,
topn_genes_label=10,
color_low="#035397",
color_high ="#F32424",
color_mid = "white",
text_size=3,
do_plot=T,
#figurenames="E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/test_scatterplot.pdf",
width = 7,
height = 7
)
#scPagwas_genes<-names(Pagwas$gene_heritability_correlation[order(Pagwas$gene_heritability_correlation,decreasing=T),])
#Single_data <- AddModuleScore(Single_data,list(scPagwas_genes[1:100],scPagwas_genes[1:500]),name=c("scPagwas_monocyte_100","scPagwas_monocyte_500"))
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_GSE138852/bar_celltypes.pdf")
Bootstrap_P_Barplot(p_results=Pagwas$bootstrap_results$bp_value[-1],
p_names=rownames(Pagwas$bootstrap_results)[-1],
title = "ad Test scPagwas",
figurenames = NULL,
width = 5,
height = 7,
do_plot=TRUE)
#dev.off()
Bootstrap_estimate_Plot(Pagwas=Pagwas,
figurenames = NULL,
width = 9,
height = 7,
do_plot=T)
Single_data$scPagwas_p <- scPagwas_p[intersect(colnames(Single_data),names(scPagwas_p))]
#thre <- sort(Single_data$scPagwas_score, decreasing = T)[ncol(Single_data) * 0.1]
Single_data$positiveCells<-rep(0,ncol(Single_data))
Single_data$positiveCells[Single_data$scPagwas_p<0.05]<-1
table(Single_data$positiveCells)
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/bar_positiveCells.pdf")
plot_bar_positie_nagtive(seurat_obj=Single_data,
var_ident="positiveCells",
var_group="oupSample.cellType",
vec_group_colors=NULL,
f_color=colorRampPalette(brewer.pal(n=10, name="RdYlBu")),
do_plot = T)
#dev.off()
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/bar_positiveCells_celltypes.pdf")
plot_bar_positie_nagtive(seurat_obj=Single_data,
var_ident="oupSample.cellType",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
#dev.off()
load("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/Pagwas_GSE138852_Prune_adsubset_kegg.RData")
Pagwas[c("Pathway_ld_gwas_data","VariableFeatures","merge_scexpr",
"rawPathway_list",
"snp_gene_df")]<-NULL
names(Pagwas)
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
library("RColorBrewer")
library("ggplot2")
library(scPagwas)
library(Seurat)
##导入开头处理的单细胞数据
Single_data =readRDS("E:/RPakage/scPagwas/inst/extdata/GSE138852_ad.rds")
scPagwas_p<-Pagwas$CellsrankPvalue$pValueHigh
names(scPagwas_p)<-rownames(Pagwas$CellsrankPvalue)
sum(scPagwas_p<0.05)
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/tsne_test_ad.pdf")
DimPlot(Single_data,reduction="tsne",group.by = "oupSample.cellType",pt.size=0.8,
label = TRUE, repel=TRUE)+ labs(x="TSNE",y="")+
scale_color_d3() +
theme(aspect.ratio=1)
#dev.off()
setwd("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test")
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
scPagwas_p=scPagwas_p,
Single_data=Single_data,
p_thre = 0.05,
filename = "ad_pruneGSE138852",
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#000957", highColor = "#EBE645",
size = 0.5,
title = "scPagwas_score",
do_plot = T)
Single_data$scPagwas_p <- scPagwas_p[intersect(colnames(Single_data),names(scPagwas_p))]
#thre <- sort(Single_data$scPagwas_score, decreasing = T)[ncol(Single_data) * 0.1]
Single_data$positiveCells<-rep(0,ncol(Single_data))
Single_data$positiveCells[Single_data$scPagwas_p<0.05]<-1
table(Single_data$positiveCells)
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/bar_positiveCells.pdf")
plot_bar_positie_nagtive(seurat_obj=Single_data,
var_ident="positiveCells",
var_group="oupSample.cellType",
vec_group_colors=NULL,
f_color=colorRampPalette(brewer.pal(n=10, name="RdYlBu")),
do_plot = T)
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/bar_positiveCells_celltypes.pdf")
plot_bar_positie_nagtive(seurat_obj=Single_data,
var_ident="oupSample.cellType",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
fortify.Seurat <- function(x){
xy <- as.data.frame(Embeddings(x, reduction = "umap"))
colnames(xy) <- c("UMAP_1", "UMAP_2")
xy$UMAP_1 <- as.numeric(xy$UMAP_1)
xy$UMAP_2 <- as.numeric(xy$UMAP_2)
xy2 <- as.data.frame(Embeddings(x, reduction = "tsne"))
colnames(xy2) <- c("TSNE_1", "TSNE_2")
xy2$TSNE_1 <- as.numeric(xy2$TSNE_1)
xy2$TSNE_2 <- as.numeric(xy2$TSNE_2)
xy<-cbind(xy,xy2)
return(cbind(xy, as.data.frame(x@meta.data)))
}
all_fortify_can <- fortify.Seurat(Single_data)
#Pagwas$Pathway_single_results
Pagwas$Celltype_anno$scPagwas_score<-Pagwas$scPagwas_score
Pagwas$Celltype_anno$pValueHigh <-Pagwas$CellsrankPvalue$pValueHigh
#Pagwas$Celltype_anno$slingPseudotime<- slingPseudotime[rownames(Pagwas$Celltype_anno)]
Pagwas_pca<-as.data.frame(t(data.matrix(Pagwas$Pathway_single_results)))
Pagwas_pca <- do.call(data.frame,                      # Replace Inf in data by NA
lapply(Pagwas_pca,
function(x) replace(x, is.infinite(x), NA)))
Pagwas_pca<- t(na.omit(t(Pagwas_pca)))
rownames(Pagwas_pca)<-colnames(Pagwas$Pathway_single_results)
Pagwas_seu<-CreateSeuratObject(
Pagwas_pca,
project = "CreateSeuratObject",
assay = "RNA",
names.field = 1,
names.delim = "_",
meta.data = Pagwas$Celltype_anno[colnames(Pagwas_pca),]
)
Idents(Pagwas_seu)<-Pagwas_seu$annotation
#ls_scCell_markerpa <- FindAllMarkers(object = ls_scCell)
#Pagwas_seu$slingPseudotime<-slingPseudotime[colnames(Pagwas_seu)]
Pagwas_seu<-ScaleData(Pagwas_seu)
Pagwas_seu <- FindVariableFeatures(object = Pagwas_seu,nfeatures = round(dim(Pagwas_seu)[1]*0.2))
Pagwas_seu <- RunPCA(object = Pagwas_seu, assay = "RNA", features = VariableFeatures(Pagwas_seu), npcs = 30)
Pagwas_seu <- RunTSNE(object = Pagwas_seu,assay = "RNA", reduction = "pca", dims = 1:30)
Pagwas_seu <- RunUMAP(object = Pagwas_seu, assay ="RNA", reduction = "pca", dims = 1:30)
Pagwas_fortify <- fortify.Seurat(Pagwas_seu)
#  pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/Slingshot.plot.pdf")
DimPlot(Pagwas_seu,group.by = "annotation",label = F)+ #umap_theme()+ ggtitle("annotation")+
theme(aspect.ratio=1)
#  dev.off()
Pagwas_fortify <- fortify.Seurat(Pagwas_seu)
#  pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/Slingshot.plot.pdf")
DimPlot(Pagwas_seu,group.by = "annotation",label = F)+ #umap_theme()+ ggtitle("annotation")+
theme(aspect.ratio=1)
#  dev.off()
umap_theme <- function(){
theme_grey() %+replace%
theme(panel.background = element_rect(fill = "white", colour = "white", size = 0.1),
axis.text.x  = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y  = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.key=element_blank())
}
plot1 <- ggplot() +
geom_point(data = Pagwas_fortify,
aes(x = UMAP_1, y = UMAP_2,color =scPagwas_score), size = 0.6, alpha = 1) +
umap_theme() +
scale_colour_gradient2(low="#8479E1",mid="#F7F5F2",high="#FD5D5D")+
theme(aspect.ratio=1) +
guides(colour = guide_legend(override.aes = list(size=3)))
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/umap_opc_scPagwas_score.pdf")
print(plot1)
#dev.off()
Pagwas_fortify$p_thre<-rep("non",nrow(Pagwas_fortify))
Pagwas_fortify$p_thre[which(Pagwas_fortify$pValueHigh<0.05)]<-"<0.05"
plot2 <-  ggplot() +
geom_point(data = Pagwas_fortify,
aes(x = UMAP_1, y = UMAP_2,color =p_thre), size =0.6, alpha = 1) +
umap_theme() +
scale_color_manual(values = c("non" = "#05595B", "<0.05" = "#E45826"))+
theme(aspect.ratio=1) +
guides(colour = guide_legend(override.aes = list(size=3)))
#pdf("E:/OneDrive/GWAS_Multiomics/ad_test/5.6test/ad_pruneGSE138852/umap_opc_scPagwas_p.pdf")
print(plot2)
#  dev.off()
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=Single_data,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
vec_group_colors= pal_d3(alpha =0.5)(10),
do_plot = T
)
rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
top5genes
Single_data
head(Single_data@meta.data)
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=Single_data,
assay="RNA", slot="data",
var_group="oupSample.cellType",
vec_features=top5genes,
vec_group_colors= pal_d3(alpha =0.5)(10),
do_plot = T
)
devtools::document()
devtools::document()
