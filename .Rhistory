Pathway_list = Pathway_list,
min.pathway.size = min.pathway.size,
max.pathway.size = max.pathway.size
)
devtools::load_all(".")
Pagwas <- Pathway_pcascore_run(
Pagwas = Pagwas,
Pathway_list = Pathway_list,
min.pathway.size = min.pathway.size,
max.pathway.size = max.pathway.size
)
suppressMessages(gwas_data <- bigreadr::fread2(gwas_data))
Pagwas <- GWAS_summary_input(
Pagwas = Pagwas,
gwas_data = gwas_data,
maf_filter = maf_filter
)
snp_gene_df <- Snp2Gene(snp = Pagwas$gwas_data, refGene = block_annotation, marg = marg)
snp_gene_df$slope <- rep(1, nrow(snp_gene_df))
Pagwas$snp_gene_df <- snp_gene_df[snp_gene_df$Disstance == "0", ]
Pagwas <- Pathway_annotation_input(
Pagwas = Pagwas,
block_annotation = block_annotation
)
Pagwas <- Link_pathway_blocks_gwas(
Pagwas = Pagwas,
chrom_ld = chrom_ld,
split_n = split_n,
singlecell = singlecell,
celltype = celltype,
ncores = ncores
)
Pagwas<- scPagwas_perform_regression(Pagwas,
Pathway_ld_gwas_data = scPathway_ld_gwas_data,
ncores = ncores)
names(Pagwas)
Pagwas$scbootstrap_results <- scGet_bootresults_df(
value_collection = df,
annotations = names(Pagwas$sclm_results),
model_estimates = Pagwas$sclm_results
)
Pagwas$Pathway_sclm_results
Pagwas$scbootstrap_results <- scGet_bootresults_df(
value_collection =Pagwas$Pathway_sclm_results,
annotations = names(Pagwas$sclm_results),
model_estimates = Pagwas$sclm_results
)
value_collection =Pagwas$Pathway_sclm_results
annotations = names(Pagwas$sclm_results)
model_estimates = Pagwas$sclm_results
Pagwas <- scBoot_evaluate(
Pagwas=Pagwas,
Pathway_ld_gwas_data=scPathway_ld_gwas_data,
bootstrap_iters=bootstrap_iters,
ncores = ncores,
part = 0.5
)
bootstrap_iters
Pagwas <- scBoot_evaluate(
Pagwas=Pagwas,
Pathway_ld_gwas_data=scPathway_ld_gwas_data,
bootstrap_iters=iters,
ncores = ncores,
part = 0.5
)
devtools::load_all(".")
Pagwas <- scBoot_evaluate(
Pagwas=Pagwas,
Pathway_ld_gwas_data=scPathway_ld_gwas_data,
bootstrap_iters=iters,
ncores = ncores,
part = 0.5
)
Pagwas$sclm_results
Pagwas$scbootstrap_results
head(Pagwas$scbootstrap_results)
Pagwas <- scPagwas_perform_score(
Pagwas = Pagwas,
remove_outlier = TRUE
)
Pagwas <- scGet_gene_heritability_correlation(Pagwas = Pagwas)
Pagwas[c(
"VariableFeatures", "merge_scexpr",
"rawPathway_list"
)] <- NULL
# }
Pagwas[c("snp_gene_df")] <- NULL
scPagwas_pca <- SeuratObject::CreateAssayObject(data = Pagwas$pca_scCell_mat)
scPagwas_lm <- SeuratObject::CreateAssayObject(data = t(data.matrix(Pagwas$Pathway_sclm_results)))
#Single_data[["scPagwasPaHeritability"]] <- scPagwas_pathway
Single_data[["scPagwasPaPca"]] <- scPagwas_pca
Single_data[["scPagwaslmHeritability"]] <- scPagwas_lm
Pagwas[c("pca_scCell_mat", "Pathway_sclm_results", "Pathway_single_results")] <- NULL
scPagwas_topgenes <- names(Pagwas$gene_heritability_correlation[order(Pagwas$gene_heritability_correlation, decreasing = T), ])[1:n_topgenes]
Single_data <- Seurat::AddModuleScore(Single_data, assay = assay, list(scPagwas_topgenes), name = c("scPagwas.topgenes.Score"))
Pagwas$scbootstrap_results$bp_value[-1]
Single_data$CellLmpValue <- Pagwas$scbootstrap_results$bp_value[-1]
length(Pagwas$scbootstrap_results$bp_value[-1])
head(Pagwas$scbootstrap_results)
Single_data$CellLmpValue <- Pagwas$scbootstrap_results$bp_value
Single_data@misc <- Pagwas
SOAR::Remove(SOAR::Objects())
Bootstrap_P_Barplot(p_results=Pagwas_data@misc$bootstrap_results$bp_value[-1],
p_names=rownames(Pagwas_data@misc$bootstrap_results)[-1],
figurenames = NULL,
width = 5,
height = 7,
do_plot=T,
title = "Test scPagwas")
devtools::load_all(".")
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Wed Jun 01 15:46:40 2022 ------##
##------ Wed Jun 01 15:46:46 2022 ------##
##------ Wed Jun 01 15:46:57 2022 ------##
##------ Wed Jun 01 15:46:57 2022 ------##
##------ Wed Jun 01 15:46:57 2022 ------##
##------ Wed Jun 01 15:46:58 2022 ------##
##------ Wed Jun 01 15:47:19 2022 ------##
##------ Wed Jun 01 15:47:20 2022 ------##
devtools::load_all(".")
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Wed Jun 01 15:48:19 2022 ------##
##------ Wed Jun 01 15:48:23 2022 ------##
##------ Wed Jun 01 15:48:33 2022 ------##
##------ Wed Jun 01 15:48:34 2022 ------##
##------ Wed Jun 01 15:48:34 2022 ------##
##------ Wed Jun 01 15:48:36 2022 ------##
##------ Wed Jun 01 15:48:59 2022 ------##
##------ Wed Jun 01 15:49:00 2022 ------##
##------ Wed Jun 01 15:49:16 2022 ------##
Bootstrap_P_Barplot(p_results=Pagwas_data@misc$bootstrap_results$bp_value[-1],
p_names=rownames(Pagwas_data@misc$bootstrap_results)[-1],
figurenames = NULL,
width = 5,
height = 7,
do_plot=T,
title = "Test scPagwas")
devtools::load_all(".")
scPagwas_Visualization(Single_data=Pagwas_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "blue",
highColor = "#EBE645",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
quantile(Pagwas_data$scPagwas.topgenes.Score1)
?v
?scPagwas_Visualization
?ggscatter
Single_data$scPagwas.topgenes.Score1 <- scPagwas_score_filter(scPagwas_score = Single_data$scPagwas.topgenes.Score1)
scPagwas_Visualization(Single_data=Pagwas_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "blue",
highColor = "#EBE645",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
devtools::load_all(".")
Single_data$scPagwas.topgenes.Score1
Single_data$scPagwas.topgenes.Score1 <- scPagwas_score_filter(scPagwas_score = Single_data$scPagwas.topgenes.Score1)
scPagwas_Visualization(Single_data=Pagwas_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "blue",
highColor = "#EBE645",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
scPagwas_Visualization(Single_data=Pagwas_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "#EBE645",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
scPagwas_Visualization(Single_data=Pagwas_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "black",
highColor = "#EBE645",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
scPagwas_Visualization(Single_data=Pagwas_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
devtools::load_all(".")
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
devtools::load_all(".")
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
names(Pagwas)
dim(Pagwas$sclm_results)
Pagwas$sclm_results
length(Pagwas$sclm_results)
Pagwas <- Single_data_input(
Pagwas = Pagwas,
assay = assay,
# nfeatures =nfeatures,
Single_data = Single_data,
Pathway_list = Pathway_list,
min_clustercells = min_clustercells
)
Pagwas <- Pathway_pcascore_run(
Pagwas = Pagwas,
Pathway_list = Pathway_list,
min.pathway.size = min.pathway.size,
max.pathway.size = max.pathway.size
)
dim(Pagwas$pca_scCell_mat)
dim( t(Pagwas$pca_scCell_mat))
?%*%
crossprod(t(matrix(Pagwas$sclm_results,nrow = 1)),t(Pagwas$pca_scCell_mat))
dim(t(matrix(Pagwas$sclm_results,nrow = 1)))
matrix(Pagwas$sclm_results,nrow = 1)
crossprod(matrix(Pagwas$sclm_results,nrow = 1),Pagwas$pca_scCell_mat)
crossprod(t(matrix(Pagwas$sclm_results,nrow = 1)),Pagwas$pca_scCell_mat)
crossprod(Pagwas$pca_scCell_mat,t(matrix(Pagwas$sclm_results,nrow = 1)))
crossprod(Pagwas$pca_scCell_mat,matrix(Pagwas$sclm_results,nrow = 1))
dim(t(matrix(Pagwas$sclm_results,nrow = 1)))
dim(t(Pagwas$pca_scCell_mat))
crossprod(t(matrix(Pagwas$sclm_results,nrow = 1)),Pagwas$pca_scCell_mat)
colSums(matrix(Pagwas$sclm_results,nrow = 1)*Pagwas$pca_scCell_mat)
matrix(Pagwas$sclm_results,nrow = 1)
dim(matrix(Pagwas$sclm_results,nrow = 1))
dim(Pagwas$pca_scCell_mat)
matrix(Pagwas$sclm_results,nrow = 1) * t(Pagwas$pca_scCell_mat)
dim(matrix(Pagwas$sclm_results,nrow = 1))
t(Pagwas$pca_scCell_mat)
dim(t(Pagwas$pca_scCell_mat))
matrix(Pagwas$sclm_results,ncol = 1)
Pagwas$pca_scCell_mat %*% matrix(Pagwas$sclm_results,ncol = 1)
dim(Pagwas$pca_scCell_mat %*% matrix(Pagwas$sclm_results,ncol = 1))
dim(Pagwas$pca_scCell_mat)
dimmatrix(Pagwas$sclm_results,ncol = 1)
dim(matrix(Pagwas$sclm_results,ncol = 1))
dim(Pagwas$pca_scCell_mat)
col_a<-apply(Pagwas$pca_scCell_mat,1,function(x){
x*a
})
a<-matrix(Pagwas$sclm_results,ncol = 1)
col_a<-apply(Pagwas$pca_scCell_mat,1,function(x){
x*a
})
dim(col_a)
rowSums(apply(Pagwas$pca_scCell_mat,1,function(x){
x*a
}))
Pagwas$sclm_allsnpscore<-rowSums(apply(Pagwas$pca_scCell_mat,1,function(x){
x*a
}))
Pagwas$sclm_allsnpscore
class(Pagwas$sclm_allsnpscore)
Single_data$sclm_allsnpscore<-Pagwas$sclm_allsnpscore
devtools::load_all(".")
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
Pagwas$sclm_allsnpscore<-scPagwas_score_filter(scPagwas_score = Pagwas$sclm_allsnpscore)
Single_data$sclm_allsnpscore<-Pagwas$sclm_allsnpscore
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
sparse_lmcor <- corSparse(
X = t(as_matrix(Pagwas$data_mat)),
Y = data.matrix(Pagwas$sclm_allsnpscore)
)
rownames(sparse_lmcor) <- rownames(Pagwas$data_mat)
colnames(sparse_lmcor) <- "allsnp_gene_heritability_correlation"
sparse_lmcor[is.nan(sparse_lmcor)] <- 0
Pagwas$allsnp_gene_heritability_correlation <- sparse_cor
Pagwas$allsnp_gene_heritability_correlation <- sparse_lmcor
scPagwaslm_topgenes <- names(Pagwas$allsnp_gene_heritability_correlation[order(Pagwas$allsnp_gene_heritability_correlation, decreasing = T), ])[1:n_topgenes]
scPagwaslm_topgenes <- names(Pagwas$allsnp_gene_heritability_correlation[order(Pagwas$allsnp_gene_heritability_correlation, decreasing = T), ])[1:n_topgenes]
Single_data <- Seurat::AddModuleScore(Single_data, assay = assay, list(scPagwas_topgenes,scPagwaslm_topgenes),
name = c("scPagwas.topgenes.Score","scPagwas.lmtopgenes.Score"))
Single_data$scPagwas.lmtopgenes.Score2 <- scPagwas_score_filter(scPagwas_score = Single_data$scPagwas.lmtopgenes.Score2)
devtools::load_all(".")
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
devtools::load_all(".")
Single_data$scPagwas.topgenes.Score1 <- scPagwas_score_filter(scPagwas_score = Single_data$scPagwas.topgenes.Score1)
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "black",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
scPagwas_Visualization(Single_data=Single_data,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "red",
output.dirs="monosimu",
size = 0.5,
do_plot = T)
gc()
devtools::load_all(".")
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Wed Jun 01 17:02:40 2022 ------##
##------ Wed Jun 01 17:02:44 2022 ------##
##------ Wed Jun 01 17:02:56 2022 ------##
##------ Wed Jun 01 17:02:57 2022 ------##
##------ Wed Jun 01 17:02:57 2022 ------##
##------ Wed Jun 01 17:02:58 2022 ------##
#Pagwas$Pathway_ld_gwas_data <- NULL
Pagwas <- scPagwas_perform_score(
Pagwas = Pagwas,
remove_outlier = TRUE,
)
devtools::load_all(".")
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Wed Jun 01 17:07:33 2022 ------##
##------ Wed Jun 01 17:07:37 2022 ------##
##------ Wed Jun 01 17:07:49 2022 ------##
##------ Wed Jun 01 17:07:49 2022 ------##
##------ Wed Jun 01 17:07:50 2022 ------##
##------ Wed Jun 01 17:07:51 2022 ------##
##------ Wed Jun 01 17:08:08 2022 ------##
##------ Wed Jun 01 17:08:09 2022 ------##
##------ Wed Jun 01 17:08:28 2022 ------##
gc()
gc()
library(ggplot2)
suppressMessages(library(Seurat))
suppressMessages(library("dplyr"))
#Input pathway gene list, you can construct with youself.
data(Genes_by_pathway_kegg)
#gene annotation files.
data(block_annotation)
#LD data
data(chrom_ld)
#
#1.start to run the wrapper functions for preprogress.
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Wed Jun 01 17:14:45 2022 ------##
##------ Wed Jun 01 17:14:51 2022 ------##
##------ Wed Jun 01 17:15:02 2022 ------##
##------ Wed Jun 01 17:15:02 2022 ------##
##------ Wed Jun 01 17:15:03 2022 ------##
##------ Wed Jun 01 17:15:04 2022 ------##
##------ Wed Jun 01 17:15:21 2022 ------##
##------ Wed Jun 01 17:15:22 2022 ------##
##------ Wed Jun 01 17:15:39 2022 ------##
devtools::load_all(".")
Pagwas_data<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="test",
output.dirs="scPagwastest_output",
block_annotation = block_annotation,
assay="RNA",
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld,
singlecell=T,
seruat_return=T,
celltype=T,
ncores = 2,
split_n=1)
##------ Wed Jun 01 17:17:31 2022 ------##
##------ Wed Jun 01 17:17:36 2022 ------##
##------ Wed Jun 01 17:17:47 2022 ------##
##------ Wed Jun 01 17:17:47 2022 ------##
##------ Wed Jun 01 17:17:48 2022 ------##
##------ Wed Jun 01 17:17:49 2022 ------##
##------ Wed Jun 01 17:18:09 2022 ------##
##------ Wed Jun 01 17:18:11 2022 ------##
##------ Wed Jun 01 17:18:29 2022 ------##
gc()
tempdir()
tempdir()
usethis::edit_r_environ(scope = "user")
