---
title: "Prune_GwasSummaryFIles_plink"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Prune_GwasSummaryFIles_plink}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(scPagwas)
```


# Prune the gwas summary statistics file by plink

The markdown is Under editing!!
## 处理gwas数据
```{r message=FALSE, eval = FALSE}
  GWAS_raw <-read_table(paste("./",x,".gz",sep=""))
  GWAS_raw<-GWAS_raw[,c(1,2,3,4,5,6,9,10)]
  colnames(GWAS_raw)<-c("chrom","pos","REF","ALT","rsid","nearest_genes","beta","se")
  GWAS_raw$maf<-0.1
  
  write.table(GWAS_raw,file=paste("./",tolower(x),".txt",sep=""),row.names=F,quote=F)
```

## 提取SNP信息
```{bash, eval = FALSE }
mkdir tempfile
for i in finngen_r7_c3_breast_exallc
do
awk  '{print $5 }' ${i}.txt  > ./tempfile/${i}_SNP_list.txt
done

```


```{bash, eval = FALSE }
for i in $(seq 1 22)  
do 
echo $i
plink 
--bfile ./02_partitioned_LD_score_estimation/1000G_EUR_Phase3_plink/1000G.EUR.QC.$i 
--extract ./tempfile/${j}_SNP_list.txt 
--noweb --make-bed --out ./tempfile/1000G.EUR.QC.${j}_${i}_filtered
done 
```

## 过滤LD
```{bash, eval = FALSE }
for i in $(seq 1 22)  
do 
echo $i
plink 
--bfile ./tempfile/1000G.EUR.QC.${j}_${i}_filtered 
--indep-pairwise 50 5 0.8 
--out  ./tempfile/${j}_${i}_plink_prune_EUR_filtered_LD0.8
done 
```


## 合并结果文件
```{bash, eval = FALSE }
cat [${j}]*.prune.in > ${j}_EUR_LD0.8.prune
```

## 将结果snp和gwas数据合并
```{r message=FALSE, eval = FALSE}
library(readr)
library(dplyr)

for (i in c("finngen_r7_c3_breast_herneg_exallc")) {
    print(i)
    gwas<-read_table(paste0("./",i,".txt"))
    SNP_prune<- read_table(paste0("./finngen_R7/tempfile/",i,"_EUR_LD0.8.prune"))
    SNP_prune<-SNP_prune[!duplicated(unlist(SNP_prune)),]
    colnames(SNP_prune)<-"rsid"
    #### Left Join using inner_join function 
   gwas= gwas %>% inner_join(SNP_prune,by="rsid")
    print(nrow(gwas))
   write.table(gwas,file= paste0("./",i,"_prune.txt"),,row.names=F,quote=F)
        print(i)
#gc()
}

```
